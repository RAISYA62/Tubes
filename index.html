<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pengklasifikasian Nilai Ujian Mahasiswa - Bubble vs Merge</title>

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#0f1a33;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --focus: rgba(255,255,255,.22);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 600px at 18% 10%, rgba(98,170,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 18%, rgba(255,120,210,.18), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height: 100vh;
      padding: 22px;
    }
    .container{ max-width: 1200px; margin: 0 auto; }
    header{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 16px; padding: 10px 6px 18px;
    }
    h1{ margin:0; font-size: clamp(20px, 2.2vw, 30px); letter-spacing: .2px; }
    .subtitle{
      margin: 8px 0 0; color: var(--muted);
      max-width: 820px; line-height: 1.55; font-size: 0.98rem;
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 8px 10px; border-radius: 999px;
      color: var(--muted); font-size: .9rem; white-space: nowrap;
    }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items:start; }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .cardHeader{
      padding: 16px 16px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,0));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .cardTitle{ margin:0; font-size: 1.08rem; letter-spacing:.2px; }
    .cardHint{ margin: 6px 0 0; color: var(--muted); font-size: .93rem; line-height: 1.45; }
    .cardBody{ padding: 14px 16px 16px; }
    .row{ display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }
    label{ color: var(--muted); font-size:.92rem; }
    input, select, textarea{
      color: var(--text);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: var(--focus);
      box-shadow: 0 0 0 4px rgba(255,255,255,.08);
    }
    textarea{
      width:100%;
      height: 240px;
      resize: vertical;
      line-height: 1.5;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: .92rem;
    }
    .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      font-weight: 700;
      letter-spacing: .2px;
    }
    .btn:hover{ background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }
    .btnPrimary{ background: rgba(255,255,255,.16); border-color: rgba(255,255,255,.26); }
    .btnDanger{ background: rgba(255,120,120,.16); border-color: rgba(255,120,120,.30); }
    .section{
      border: 1px solid rgba(255,255,255,.10);
      background: var(--card2);
      border-radius: var(--radius2);
      padding: 12px;
      margin-top: 12px;
    }
    .metaLine{ margin: 10px 0 0; color: var(--muted); font-size: .93rem; }
    .badges{ display:flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 6px; }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text); font-weight: 700; font-size: .9rem;
    }
    .badge small{ color: var(--muted); font-weight: 800; }
    .tableWrap{
      overflow:auto; max-height: 290px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
    }
    table{ width:100%; border-collapse: collapse; min-width: 520px; }
    th, td{
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      text-align:left;
      font-size: .95rem;
      white-space: nowrap;
    }
    th{
      position: sticky; top: 0;
      background: rgba(10,18,32,.75);
      backdrop-filter: blur(10px);
      z-index: 1;
      color: rgba(255,255,255,.85);
      font-weight: 800;
    }
    tr:hover td{ background: rgba(255,255,255,.04); }
    code{
      color: rgba(255,255,255,.85);
      background: rgba(255,255,255,.08);
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.12);
    }
    .box{
      margin-top: 12px;
      border-radius: 14px;
      padding: 12px;
      background: rgba(0,0,0,.10);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.88);
      line-height: 1.55;
      font-size: .95rem;
    }
    .chartWrap{
      margin-top: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.10);
      padding: 10px;
    }
    canvas{ max-width: 100%; }
    .hintLine{
      display:flex; gap:10px; align-items:flex-start; flex-wrap: wrap;
      color: var(--muted); font-size: .92rem; margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div>
        <h1>Pengklasifikasian Nilai Ujian Mahasiswa</h1>
        <p class="subtitle">
          Versi ini dibuat agar <b>Merge Sort (rekursif)</b> terlihat lebih cepat sejak data kecil:
          Merge dioptimasi (buffer reusable) dan Bubble dibuat versi standar tanpa early-stop.
          Program juga menghitung <b>batas perpindahan (crossover)</b> dari hasil benchmark.
        </p>
      </div>
      <div class="pill">Go + HTML • Bubble vs Merge</div>
    </header>

    <div class="grid">

      <!-- LEFT -->
      <section class="card">
        <div class="cardHeader">
          <h2 class="cardTitle">Input Data Mahasiswa</h2>
          <p class="cardHint">
            Format tiap baris: <code>Nama,Score</code> (0..100). Contoh: <code>Budi,78</code>
          </p>
        </div>

        <div class="cardBody">
          <div class="section">
            <div class="row">
              <label><b>Generator</b></label>
              <label>Jumlah (N)</label>
              <input id="genN" type="number" min="1" max="100000" value="100" style="width:120px;" />
              <label>Pola</label>
              <select id="genMode">
                <option value="random">Random (acak)</option>
                <option value="sorted">Terurut naik</option>
                <option value="reversed">Terbalik turun</option>
              </select>
              <button class="btn btnPrimary" id="btnGenerate">Generate Data</button>
              <button class="btn btnDanger" id="btnClear">Clear</button>
            </div>
            <div class="hintLine">
              <span>Tips: klik Benchmark untuk melihat grafik dan crossover (batas perpindahan).</span>
            </div>
          </div>

          <textarea id="rawInput">Budi,78
Siti,92
Andi,65
Rina,40
Dewi,55
Joko,85</textarea>

          <div class="section">
            <div class="row">
              <label><b>Algoritma</b></label>
              <select id="algorithm">
                <option value="bubble">Bubble Sort (Iteratif)</option>
                <option value="merge">Merge Sort (Rekursif)</option>
              </select>
              <button class="btn btnPrimary" id="btnSort">Urutkan + Klasifikasikan</button>
            </div>
            <p id="sortInfo" class="metaLine"></p>
          </div>

          <div class="section">
            <h3 style="margin:0 0 8px;">Hasil Sorting &amp; Klasifikasi</h3>
            <div id="summary" class="badges"></div>

            <div class="tableWrap">
              <table>
                <thead>
                  <tr><th>No</th><th>Nama</th><th>Nilai</th><th>Grade</th></tr>
                </thead>
                <tbody id="resultBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="card">
        <div class="cardHeader">
          <h2 class="cardTitle">Analisis Efisiensi (Running Time)</h2>
          <p class="cardHint">
            Klik untuk mengukur running time pada ukuran input 1, 10, 20, ..., 10000 lalu menggambar grafiknya.
          </p>
        </div>

        <div class="cardBody">
          <div class="row">
            <button class="btn btnPrimary" id="btnBenchmark">Jalankan Benchmark + Gambar Grafik</button>
          </div>

          <p id="benchInfo" class="metaLine"></p>

          <div class="chartWrap">
            <canvas id="chart" height="220"></canvas>
          </div>

          <div id="complexity" class="box" style="display:none;"></div>
        </div>
      </section>

    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    const $ = (id) => document.getElementById(id);

    function escapeHtml(s) {
      return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    // =========================
    // Generator
    // =========================
    function pad3(n){ return String(n).padStart(3, "0"); }

    function generateStudents(n, mode) {
      const scores = [];
      for (let i = 0; i < n; i++) scores.push(Math.floor(Math.random() * 101));
      if (mode === "sorted") scores.sort((a,b) => a-b);
      else if (mode === "reversed") scores.sort((a,b) => b-a);

      const lines = [];
      for (let i = 0; i < n; i++) lines.push(`Mhs${pad3(i+1)},${scores[i]}`);
      return lines.join("\n");
    }

    $("btnGenerate").addEventListener("click", () => {
      const n = parseInt($("genN").value, 10);
      if (!Number.isFinite(n) || n < 1) { alert("Jumlah (N) minimal 1"); return; }
      const mode = $("genMode").value;
      $("rawInput").value = generateStudents(n, mode);

      $("sortInfo").textContent = "";
      $("resultBody").innerHTML = "";
      $("summary").innerHTML = "";
    });

    $("btnClear").addEventListener("click", () => {
      $("rawInput").value = "";
      $("sortInfo").textContent = "";
      $("resultBody").innerHTML = "";
      $("summary").innerHTML = "";
    });

    // =========================
    // Sort + classify
    // =========================
    $("btnSort").addEventListener("click", async () => {
      $("sortInfo").textContent = "Memproses...";
      $("resultBody").innerHTML = "";
      $("summary").innerHTML = "";

      const payload = { algorithm: $("algorithm").value, rawInput: $("rawInput").value };

      const res = await fetch("/api/sort", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if (!res.ok || data.error) {
        $("sortInfo").textContent = "Error: " + (data.error || res.statusText);
        return;
      }

      $("sortInfo").textContent = `Selesai (${data.algorithm}). Waktu sorting: ${data.elapsedUS} μs`;

      const s = data.summary || {};
      $("summary").innerHTML =
        `<span class="badge"><small>A</small> ${s.A ?? 0}</span>` +
        `<span class="badge"><small>B</small> ${s.B ?? 0}</span>` +
        `<span class="badge"><small>C</small> ${s.C ?? 0}</span>` +
        `<span class="badge"><small>D</small> ${s.D ?? 0}</span>` +
        `<span class="badge"><small>E</small> ${s.E ?? 0}</span>`;

      data.sorted.forEach((st, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i+1}</td><td>${escapeHtml(st.name)}</td><td>${st.score}</td><td>${st.grade}</td>`;
        $("resultBody").appendChild(tr);
      });
    });

    // =========================
    // Benchmark + chart + crossover
    // =========================
    let chart;

    $("btnBenchmark").addEventListener("click", async () => {
      $("benchInfo").textContent = "Benchmark berjalan...";
      const cx = $("complexity");
      cx.style.display = "none";
      cx.innerHTML = "";

      const res = await fetch("/api/benchmark");
      const data = await res.json();
      if (!res.ok) { $("benchInfo").textContent = "Error benchmark."; return; }

      $("benchInfo").textContent = data.note || "Benchmark selesai.";

      const ctx = $("chart");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: data.sizes,
          datasets: [
            { label: "Bubble Sort (ms)", data: data.bubbleMS, tension: 0.2 },
            { label: "Merge Sort (ms)", data: data.mergeMS, tension: 0.2 }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: "top" } },
          scales: {
            x: { title: { display: true, text: "Ukuran input (n)" } },
            y: { title: { display: true, text: "Waktu (ms)" } }
          }
        }
      });

      cx.innerHTML =
        `<b>Kelas kompleksitas waktu:</b><br>` +
        `Bubble Sort: ${escapeHtml(data.bubbleClass)}<br>` +
        `Merge Sort: ${escapeHtml(data.mergeClass)}<br><br>` +
        `<b>Batas perpindahan (crossover):</b><br>` +
        `${escapeHtml(data.crossoverHint)}<br>` +
        `crossoverN = <b>${data.crossoverN}</b>`;
      cx.style.display = "block";
    });
  </script>
</body>
</html>
